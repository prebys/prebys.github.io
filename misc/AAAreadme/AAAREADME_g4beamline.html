<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html><head>
<meta content="text/html; charset=ISO-8859-1" http-equiv="content-type"><title>g4beamline</title></head><body>
<h1 style="text-align: center;">Some G4Beamline Notes</h1>
<span style="font-style: italic;">(last updated Dec 18, 2014)</span><br>
<br>
These are a few random notes on running g4beamline, so I can stop
relearning stuff.&nbsp; I should read it every time I start a
g4beamline project.<br>
<br>
At the time of this writing, my state of the art g4beamline script is <br>
<span style="font-weight: bold;">~/GoogleDrive/mu2e/g4beamline_study/mu2e_new.g4bl</span><br>
It reads in <span style="font-weight: bold;">MAD_Eliana/mu2e_upstream.g4bl_seg&lt;n&gt; </span>and <span style="font-weight: bold;">MAD_Eliana/mu2e_downstream_seg&lt;n&gt;</span>, which in turn were automatically generated by my program <a href="AAAREADME_mad2g4bl.html">mad2g4bl</a> based on the MADX optics file "<span style="font-weight: bold;">optics.dat</span>" in the same directory.&nbsp; A lot of the stuff I've learned about g4beamline is actually contained in <a href="AAAREADME_mad2g4bl.html">that helpfile</a>.<br>
<br>
For notes specifically about running on the grid, see <a href="AAAREADME_g4beamline_grid.html">these notes</a>.<br>
<br>
Some stuff I'm constantly relearning:<br>
<ul>
  <li>Make sure to update to at least 2.16 and the newest G4beamline
data files.&nbsp; Older versions can't handle bends in both planes.<br>
  </li>
  <li>Once you've done a "<span style="font-weight: bold;">corner</span>" or a "<span style="font-weight: bold;">cornerarc</span>",
everything&nbsp; you do afterwards is in the new coordinate system, so
you can't go *back* and place stuff before it, or it will end up in a
very weird location.</li>
  <li>Similarly, the beam command uses the global coordinate system, so you can start a beam after a "<span style="font-weight: bold;">corner</span>" or "<span style="font-weight: bold;">cornerarc</span>"</li>
  <li>step size matters to get the bend correct on strong magnets.&nbsp; For strong bends, <span style="font-weight: bold;">maxStep=1.</span> is required, but this will slow things down a lot if you set it everywhere.&nbsp; The program apparently uses <span style="font-weight: bold;">ironLength</span> rather than <span style="font-weight: bold;">fieldLength</span> to determine where to use the step size, so if iron is shorter than field, you can get into trouble.</li>
  <li>(Important).&nbsp; If you place an element with "front=1", the front of the <span style="font-weight: bold;">ironLength</span> will be used.&nbsp; Be sure to set the beginning of a "cornerarc" to the beginning of the <span style="font-weight: bold;">fieldLength</span>, if the two are different.</li>
  <li>To see how to tilt and shift and RBEND for maximum aperture clearance, see how I do it in <a href="mad2g4bl.py">mad2g4bl.py</a>.<br>
  </li>

</ul>
Examples of some handy commands:<br>
<ul>
  <li><span style="font-weight: bold;">reference beamZ=0. referenceMomentum=8888.897288 particle=proton:</span><br>
  </li>
  <ul>
    <li>create a reference particle to check trajectory.&nbsp; Can run
just the reference particle by setting nEvents=0.&nbsp; Will not show
up in any ntuples</li>
  </ul>
  <li style="font-weight: bold;">zntuple z=$zPos:</li>
  <ul>
    <li>create and ntuple of tracks crossing a certain z position<br>
    </li>
  </ul>
  <li><span style="font-weight: bold;">profile&nbsp; zloop=$zStart:$zEnd:100 particle=proton file=$profileFile: </span><br>
  </li>
  <ul>
    <li>create a fit profile at each point, which includes Twiss parameters and emittance.</li>
    <li>can be read into root with my utility G4BLProfile.C with method (TNtuple*) getNtuple().<br>
    </li>
  </ul>
  <li style="font-weight: bold;">trace nTrace=1000 oneNTuple primaryOnly=1</li>
  <ul>
    <li>track the first 1000 particles and put into the output root file as the "AllTracks" ntuple</li>
  </ul>
  <li style="font-weight: bold;">ntuple DST detectors=*:</li>
  <ul>
    <li>create a single ntuple to bundle hits for each track with an entry in all detectors listed.</li>
  </ul>
</ul>
<br>
<br>
<br>
<br>
<br>
<br>
<br>

  

</body></html>